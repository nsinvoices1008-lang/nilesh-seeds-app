<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡§®‡§ø‡§≤‡•á‡§∂ ‡§∏‡•Ä‡§°‡•ç‡§∏ - Agriculture Retail App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #E9EDEF;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 10px;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        /* Auth Card */
        .auth-card {
            background: white;
            border-radius: 20px;
            padding: 30px 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            max-width: 450px;
            margin: 30px auto;
            width: calc(100% - 40px);
        }

        .logo {
            text-align: center;
            margin-bottom: 25px;
        }

        .logo-icon {
            font-size: 50px;
            margin-bottom: 10px;
        }

        .logo h1 {
            color: #25D366;
            font-size: 28px;
            margin-bottom: 5px;
        }

        .tagline {
            color: #667781;
            font-size: 13px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            color: #000;
            font-weight: 600;
            font-size: 14px;
        }

        .form-group input, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #E9EDEF;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        .form-group input:focus, .form-group textarea:focus {
            outline: none;
            border-color: #25D366;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .error, .success {
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
            display: none;
            font-size: 14px;
        }

        .error {
            background: #ffebee;
            color: #c62828;
        }

        .success {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .error.show, .success.show {
            display: block;
        }

        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }

        .btn-primary {
            background: #25D366;
            color: white;
        }

        .btn-primary:hover {
            background: #1ea952;
        }

        .btn-primary:active {
            transform: scale(0.98);
        }

        .link-btn {
            background: none;
            border: none;
            color: #25D366;
            cursor: pointer;
            text-decoration: underline;
            font-size: 14px;
            margin-top: 15px;
            display: block;
            text-align: center;
            width: 100%;
            padding: 10px;
        }

        /* App Header */
        .app-header {
            background: #25D366;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-title {
            font-size: 20px;
            font-weight: 600;
        }

        .header-icons {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .icon-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            position: relative;
        }

        .notification-badge {
            position: absolute;
            top: 0;
            right: 0;
            background: #dc3545;
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 10px;
            font-weight: 600;
            min-width: 18px;
            text-align: center;
        }

        /* Dashboard Cards */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            padding: 15px;
        }

        .dashboard-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #000;
        }

        .card-icon {
            font-size: 28px;
        }

        .card-value {
            font-size: 32px;
            font-weight: 700;
            color: #25D366;
            margin-bottom: 5px;
        }

        .card-label {
            font-size: 14px;
            color: #667781;
        }

        /* Chat List */
        .chat-list {
            background: white;
            border-radius: 12px;
            overflow: hidden;
        }

        .chat-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #E9EDEF;
            cursor: pointer;
            transition: background 0.2s;
        }

        .chat-item:hover {
            background: #F0F2F5;
        }

        .chat-item:last-child {
            border-bottom: none;
        }

        .chat-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #25D366;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 600;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .chat-info {
            flex: 1;
            min-width: 0;
        }

        .chat-name {
            font-weight: 600;
            color: #000;
            margin-bottom: 3px;
        }

        .chat-message {
            font-size: 14px;
            color: #667781;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-meta {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
        }

        .chat-time {
            font-size: 12px;
            color: #667781;
        }

        .unread-badge {
            background: #25D366;
            color: white;
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 12px;
            font-weight: 600;
            min-width: 20px;
            text-align: center;
        }

        /* Chat Window */
        .chat-window {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 140px);
            background: white;
            border-radius: 12px;
            overflow: hidden;
        }

        .chat-header {
            background: #25D366;
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .back-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #E9EDEF;
        }

        .message-bubble {
            max-width: 70%;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            word-wrap: break-word;
        }

        .message-sent {
            background: #D9FDD3;
            margin-left: auto;
            border-bottom-right-radius: 2px;
        }

        .message-received {
            background: white;
            margin-right: auto;
            border-bottom-left-radius: 2px;
        }

        .message-time {
            font-size: 11px;
            color: #667781;
            margin-top: 5px;
            text-align: right;
        }

        .chat-input-container {
            padding: 15px;
            background: white;
            border-top: 1px solid #E9EDEF;
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px;
            border: 1px solid #E9EDEF;
            border-radius: 25px;
            font-size: 16px;
            font-family: inherit;
        }

        .send-btn {
            background: #25D366;
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #E9EDEF;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            color: #667781;
            cursor: pointer;
            padding: 5px 15px;
            position: relative;
        }

        .nav-item.active {
            color: #25D366;
        }

        .nav-icon {
            font-size: 24px;
        }

        .nav-label {
            font-size: 11px;
            font-weight: 600;
        }

        /* Proximity Alert */
        .proximity-alert {
            position: fixed;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            background: #ff9800;
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            z-index: 1001;
            display: none;
            animation: slideDown 0.3s ease;
            max-width: 90%;
            text-align: center;
        }

        .proximity-alert.show {
            display: block;
        }

        @keyframes slideDown {
            from {
                transform: translateX(-50%) translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        /* Menu Overlay */
        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 200;
            display: none;
        }

        .menu-overlay.show {
            display: block;
        }

        .menu-panel {
            position: fixed;
            top: 0;
            right: -300px;
            width: 280px;
            height: 100%;
            background: white;
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.2);
            z-index: 201;
            transition: right 0.3s ease;
            overflow-y: auto;
        }

        .menu-panel.show {
            right: 0;
        }

        .menu-header {
            background: #25D366;
            color: white;
            padding: 20px;
        }

        .menu-item {
            padding: 15px 20px;
            border-bottom: 1px solid #E9EDEF;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .menu-item:hover {
            background: #F0F2F5;
        }

        .menu-icon {
            font-size: 20px;
            width: 30px;
        }

        /* Farmer Profile */
        .profile-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 15px;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #25D366;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: 600;
        }

        .profile-info h2 {
            font-size: 22px;
            margin-bottom: 5px;
        }

        .profile-detail {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 0;
            border-bottom: 1px solid #E9EDEF;
        }

        .profile-detail:last-child {
            border-bottom: none;
        }

        .detail-icon {
            font-size: 20px;
            width: 30px;
            color: #25D366;
        }

        /* Action Buttons */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .action-btn {
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-call {
            background: #25D366;
            color: white;
        }

        .btn-video {
            background: #0088cc;
            color: white;
        }

        .btn-ledger {
            background: #ff9800;
            color: white;
        }

        .btn-chat {
            background: #128C7E;
            color: white;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .chat-window {
                height: calc(100vh - 120px);
            }
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #667781;
        }

        .empty-icon {
            font-size: 60px;
            margin-bottom: 15px;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <!-- Proximity Alert -->
    <div id="proximityAlert" class="proximity-alert"></div>

    <!-- Menu Overlay -->
    <div id="menuOverlay" class="menu-overlay" onclick="closeMenu()"></div>
    <div id="menuPanel" class="menu-panel">
        <div class="menu-header">
            <h2>‡§Æ‡•á‡§®‡•Ç</h2>
        </div>
        <div class="menu-item" onclick="changeLanguage()">
            <span class="menu-icon">üåê</span>
            <span>‡§≠‡§æ‡§∑‡§æ ‡§¨‡§¶‡§≤‡•á‡§Ç</span>
        </div>
        <div class="menu-item" onclick="logout()">
            <span class="menu-icon">üö™</span>
            <span>‡§≤‡•â‡§ó‡§Ü‡§â‡§ü</span>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="loginScreen" class="screen active">
        <div class="container">
            <div class="auth-card">
                <div class="logo">
                    <div class="logo-icon">üåæ</div>
                    <h1>‡§®‡§ø‡§≤‡•á‡§∂ ‡§∏‡•Ä‡§°‡•ç‡§∏</h1>
                    <p class="tagline">‡§Ü‡§™‡§ï‡§æ ‡§µ‡§ø‡§∂‡•ç‡§µ‡§∏‡§®‡•Ä‡§Ø ‡§ï‡•É‡§∑‡§ø ‡§∏‡§æ‡§•‡•Ä</p>
                </div>
                <div id="loginError" class="error"></div>
                <form id="loginForm" onsubmit="return false;">
                    <div class="form-group">
                        <label>‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§®‡§æ‡§Æ</label>
                        <input type="text" id="loginUsername" placeholder="‡§Ö‡§™‡§®‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç" autocomplete="username">
                    </div>
                    <div class="form-group">
                        <label>‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°</label>
                        <input type="password" id="loginPassword" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç" autocomplete="current-password">
                    </div>
                    <button type="submit" class="btn btn-primary" id="loginBtn">‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç</button>
                </form>
                <button class="link-btn" id="showRegisterBtn">‡§®‡§Ø‡§æ ‡§ñ‡§æ‡§§‡§æ ‡§¨‡§®‡§æ‡§è‡§Ç</button>
            </div>
        </div>
    </div>

    <!-- Register Screen -->
    <div id="registerScreen" class="screen">
        <div class="container">
            <div class="auth-card">
                <div class="logo">
                    <div class="logo-icon">üåæ</div>
                    <h1>‡§®‡§Ø‡§æ ‡§ñ‡§æ‡§§‡§æ ‡§¨‡§®‡§æ‡§è‡§Ç</h1>
                </div>
                <div id="registerError" class="error"></div>
                <div id="registerSuccess" class="success"></div>
                <form id="registerForm" onsubmit="return false;">
                    <div class="form-group">
                        <label>‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ</label>
                        <input type="text" id="regName" placeholder="‡§Ö‡§™‡§®‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç">
                    </div>
                    <div class="form-group">
                        <label>‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞</label>
                        <input type="tel" id="regPhone" placeholder="10 ‡§Ö‡§Ç‡§ï‡•ã‡§Ç ‡§ï‡§æ ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞" maxlength="10">
                    </div>
                    <div class="form-group">
                        <label>‡§ó‡§æ‡§Ç‡§µ</label>
                        <input type="text" id="regVillage" placeholder="‡§Ö‡§™‡§®‡§æ ‡§ó‡§æ‡§Ç‡§µ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç">
                    </div>
                    <div class="form-group">
                        <label>‡§™‡•Ç‡§∞‡§æ ‡§™‡§§‡§æ</label>
                        <textarea id="regAddress" placeholder="‡§Ö‡§™‡§®‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§™‡§§‡§æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç"></textarea>
                    </div>
                    <div class="form-group">
                        <label>‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°</label>
                        <input type="password" id="regPassword" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¨‡§®‡§æ‡§è‡§Ç">
                    </div>
                    <button type="submit" class="btn btn-primary" id="registerBtn">‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç</button>
                </form>
                <button class="link-btn" id="showLoginBtn">‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§ñ‡§æ‡§§‡§æ ‡§π‡•à? ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç</button>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="screen">
        <div class="app-header">
            <div class="header-title">‡§®‡§ø‡§≤‡•á‡§∂ ‡§∏‡•Ä‡§°‡•ç‡§∏</div>
            <div class="header-icons">
                <button class="icon-btn" onclick="showNotifications()">
                    üîî
                    <span id="notificationBadge" class="notification-badge" style="display: none;">0</span>
                </button>
                <button class="icon-btn" onclick="openMenu()">‚ò∞</button>
            </div>
        </div>

        <div class="dashboard-grid">
            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-title">‡§ï‡•Å‡§≤ ‡§ï‡§ø‡§∏‡§æ‡§®</div>
                    <div class="card-icon">üë®‚Äçüåæ</div>
                </div>
                <div class="card-value" id="totalFarmers">0</div>
                <div class="card-label">‡§™‡§Ç‡§ú‡•Ä‡§ï‡•É‡§§ ‡§ï‡§ø‡§∏‡§æ‡§®</div>
            </div>

            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-title">‡§Ü‡§ú ‡§ï‡•á ‡§∏‡§Ç‡§¶‡•á‡§∂</div>
                    <div class="card-icon">üí¨</div>
                </div>
                <div class="card-value" id="todayMessages">0</div>
                <div class="card-label">‡§®‡§è ‡§∏‡§Ç‡§¶‡•á‡§∂</div>
            </div>

            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-title">‡§®‡§ú‡§¶‡•Ä‡§ï ‡§ï‡§ø‡§∏‡§æ‡§®</div>
                    <div class="card-icon">üìç</div>
                </div>
                <div class="card-value" id="nearbyFarmers">0</div>
                <div class="card-label">100 ‡§Æ‡•Ä‡§ü‡§∞ ‡§ï‡•á ‡§≠‡•Ä‡§§‡§∞</div>
            </div>

            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-title">‡§ï‡•Å‡§≤ ‡§≤‡•á‡§®‡§¶‡•á‡§®</div>
                    <div class="card-icon">üí∞</div>
                </div>
                <div class="card-value">‚Çπ0</div>
                <div class="card-label">‡§á‡§∏ ‡§Æ‡§π‡•Ä‡§®‡•á</div>
            </div>
        </div>

        <div style="padding: 15px;">
            <h3 style="margin-bottom: 15px; color: #000;">‡§ï‡§ø‡§∏‡§æ‡§® ‡§ö‡•à‡§ü</h3>
            <div class="chat-list" id="adminChatList">
                <div class="empty-state">
                    <div class="empty-icon">üí¨</div>
                    <div>‡§ï‡•ã‡§à ‡§ö‡•à‡§ü ‡§®‡§π‡•Ä‡§Ç</div>
                </div>
            </div>
        </div>

        <div class="bottom-nav">
            <div class="nav-item active">
                <div class="nav-icon">üè†</div>
                <div class="nav-label">‡§π‡•ã‡§Æ</div>
            </div>
            <div class="nav-item" onclick="showAdminChats()">
                <div class="nav-icon">üí¨</div>
                <div class="nav-label">‡§ö‡•à‡§ü</div>
                <span id="chatBadge" class="notification-badge" style="display: none;">0</span>
            </div>
            <div class="nav-item">
                <div class="nav-icon">üë®‚Äçüåæ</div>
                <div class="nav-label">‡§ï‡§ø‡§∏‡§æ‡§®</div>
            </div>
            <div class="nav-item">
                <div class="nav-icon">üìä</div>
                <div class="nav-label">‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü</div>
            </div>
        </div>
    </div>

    <!-- Farmer Dashboard -->
    <div id="farmerDashboard" class="screen">
        <div class="app-header">
            <div class="header-title">‡§®‡§ø‡§≤‡•á‡§∂ ‡§∏‡•Ä‡§°‡•ç‡§∏</div>
            <div class="header-icons">
                <button class="icon-btn" onclick="openMenu()">‚ò∞</button>
            </div>
        </div>

        <div class="profile-section">
            <div class="profile-header">
                <div class="profile-avatar" id="farmerAvatar">üë®‚Äçüåæ</div>
                <div class="profile-info">
                    <h2 id="farmerName"></h2>
                    <div style="color: #667781; font-size: 14px;" id="farmerVillage"></div>
                </div>
            </div>

            <div class="profile-detail">
                <div class="detail-icon">üì±</div>
                <div id="farmerPhone"></div>
            </div>

            <div class="profile-detail">
                <div class="detail-icon">üìç</div>
                <div id="farmerAddress"></div>
            </div>

            <div class="profile-detail">
                <div class="detail-icon">üåç</div>
                <div id="farmerLocation">‡§∏‡•ç‡§•‡§æ‡§® ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...</div>
            </div>

            <div class="action-buttons">
                <button class="action-btn btn-call" onclick="makeCall()">
                    üìû ‡§ï‡•â‡§≤ ‡§ï‡§∞‡•á‡§Ç
                </button>
                <button class="action-btn btn-video" onclick="makeVideoCall()">
                    üìπ ‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã ‡§ï‡•â‡§≤
                </button>
                <button class="action-btn btn-chat" onclick="openFarmerChat()">
                    üí¨ ‡§ö‡•à‡§ü ‡§ï‡§∞‡•á‡§Ç
                </button>
                <button class="action-btn btn-ledger" onclick="openLedger()">
                    üìí ‡§ñ‡§æ‡§§‡§æ ‡§¶‡•á‡§ñ‡•á‡§Ç
                </button>
            </div>
        </div>

        <div class="bottom-nav">
            <div class="nav-item active">
                <div class="nav-icon">üè†</div>
                <div class="nav-label">‡§π‡•ã‡§Æ</div>
            </div>
            <div class="nav-item" onclick="openFarmerChat()">
                <div class="nav-icon">üí¨</div>
                <div class="nav-label">‡§ö‡•à‡§ü</div>
            </div>
            <div class="nav-item">
                <div class="nav-icon">üõí</div>
                <div class="nav-label">‡§ë‡§∞‡•ç‡§°‡§∞</div>
            </div>
            <div class="nav-item">
                <div class="nav-icon">üë§</div>
                <div class="nav-label">‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤</div>
            </div>
        </div>
    </div>

    <!-- Chat Screen -->
    <div id="chatScreen" class="screen">
        <div class="chat-window">
            <div class="chat-header">
                <button class="back-btn" onclick="closeChat()">‚Üê</button>
                <div class="chat-avatar" id="chatAvatar">N</div>
                <div style="flex: 1;">
                    <div style="font-weight: 600;" id="chatName">‡§®‡§ø‡§≤‡•á‡§∂ ‡§∏‡•Ä‡§°‡•ç‡§∏</div>
                    <div style="font-size: 12px; opacity: 0.9;">‡§ë‡§®‡§≤‡§æ‡§á‡§®</div>
                </div>
            </div>

            <div class="chat-messages" id="chatMessages">
                <div class="empty-state">
                    <div class="empty-icon">üí¨</div>
                    <div>‡§ï‡•ã‡§à ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§®‡§π‡•Ä‡§Ç</div>
                </div>
            </div>

            <div class="chat-input-container">
                <input type="text" class="chat-input" id="messageInput" placeholder="‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§≤‡§ø‡§ñ‡•á‡§Ç...">
                <button class="send-btn" onclick="sendMessage()">üì§</button>
            </div>
        </div>
    </div>

    <script>
        // Constants
        const SHOP_LOCATION = {
            lat: 26.8467,
            lng: 80.9462,
            name: "‡§®‡§ø‡§≤‡•á‡§∂ ‡§∏‡•Ä‡§°‡•ç‡§∏"
        };

        const PROXIMITY_THRESHOLD = 100; // meters

        // App State
        let currentUser = null;
        let farmerLocation = null;
        let locationWatchId = null;
        let proximityCheckInterval = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            console.log('App initialized');
            loadUserSession();
            setupEventListeners();
        });

        // Setup Event Listeners
        function setupEventListeners() {
            const loginForm = document.getElementById('loginForm');
            const loginBtn = document.getElementById('loginBtn');
            loginForm.addEventListener('submit', handleLogin);
            loginBtn.addEventListener('click', handleLogin);

            const registerForm = document.getElementById('registerForm');
            const registerBtn = document.getElementById('registerBtn');
            registerForm.addEventListener('submit', handleRegister);
            registerBtn.addEventListener('click', handleRegister);

            document.getElementById('showRegisterBtn').addEventListener('click', () => showScreen('registerScreen'));
            document.getElementById('showLoginBtn').addEventListener('click', () => showScreen('loginScreen'));

            // Message input enter key
            document.getElementById('messageInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });
        }

        // Show Screen
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        // Handle Login
        function handleLogin(e) {
            if (e) e.preventDefault();
            
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!username || !password) {
                showError('loginError', '‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç');
                return;
            }

            // Admin login
            if (username === 'Nilesh Seeds' && password === '1008') {
                currentUser = {
                    username: 'Nilesh Seeds',
                    role: 'admin',
                    name: 'Nilesh Seeds'
                };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showAdminDashboard();
                return;
            }

            // Farmer login
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const user = users.find(u => u.username === username && u.password === password);

            if (user) {
                currentUser = { ...user, role: 'farmer' };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showFarmerDashboard();
            } else {
                showError('loginError', '‡§ó‡§≤‡§§ ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§®‡§æ‡§Æ ‡§Ø‡§æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°');
            }
        }

        // Handle Register
        function handleRegister(e) {
            if (e) e.preventDefault();
            
            const name = document.getElementById('regName').value.trim();
            const phone = document.getElementById('regPhone').value.trim();
            const village = document.getElementById('regVillage').value.trim();
            const address = document.getElementById('regAddress').value.trim();
            const password = document.getElementById('regPassword').value;

            if (!name || !phone || !village || !address || !password) {
                showError('registerError', '‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç');
                return;
            }

            if (phone.length !== 10 || !/^\d+$/.test(phone)) {
                showError('registerError', '‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ 10 ‡§Ö‡§Ç‡§ï‡•ã‡§Ç ‡§ï‡§æ ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è');
                return;
            }

            const users = JSON.parse(localStorage.getItem('users') || '[]');
            
            if (users.find(u => u.phone === phone)) {
                showError('registerError', '‡§Ø‡§π ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§™‡§Ç‡§ú‡•Ä‡§ï‡•É‡§§ ‡§π‡•à');
                return;
            }

            const newUser = {
                username: phone,
                password: password,
                name: name,
                phone: phone,
                village: village,
                address: address,
                createdAt: new Date().toISOString()
            };

            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));

            showSuccess('registerSuccess', '‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£ ‡§∏‡§´‡§≤! ‡§ï‡•É‡§™‡§Ø‡§æ ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç');
            
            document.getElementById('registerForm').reset();

            setTimeout(() => {
                showScreen('loginScreen');
            }, 2000);
        }

        // Show Admin Dashboard
        function showAdminDashboard() {
            showScreen('adminDashboard');
            updateAdminStats();
            loadAdminChats();
        }

        // Show Farmer Dashboard
        function showFarmerDashboard() {
            showScreen('farmerDashboard');
            displayFarmerInfo();
            startLocationTracking();
        }

        // Display Farmer Info
        function displayFarmerInfo() {
            document.getElementById('farmerName').textContent = currentUser.name;
            document.getElementById('farmerVillage').textContent = currentUser.village;
            document.getElementById('farmerPhone').textContent = currentUser.phone;
            document.getElementById('farmerAddress').textContent = currentUser.address;
            document.getElementById('farmerAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
        }

        // Start Location Tracking
        function startLocationTracking() {
            if (!navigator.geolocation) {
                document.getElementById('farmerLocation').textContent = '‡§∏‡•ç‡§•‡§æ‡§® ‡§∏‡•á‡§µ‡§æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç';
                return;
            }

            locationWatchId = navigator.geolocation.watchPosition(
                (position) => {
                    farmerLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude,
                        accuracy: position.coords.accuracy
                    };

                    document.getElementById('farmerLocation').textContent = 
                        `${farmerLocation.lat.toFixed(6)}, ${farmerLocation.lng.toFixed(6)}`;

                    checkProximity();
                },
                (error) => {
                    console.error('Location error:', error);
                    document.getElementById('farmerLocation').textContent = '‡§∏‡•ç‡§•‡§æ‡§® ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§∏‡§ï‡§æ';
                },
                {
                    enableHighAccuracy: true,
                    maximumAge: 10000,
                    timeout: 5000
                }
            );

            // Check proximity every 30 seconds
            proximityCheckInterval = setInterval(checkProximity, 30000);
        }

        // Calculate Distance (Haversine formula)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371e3; // Earth radius in meters
            const œÜ1 = lat1 * Math.PI / 180;
            const œÜ2 = lat2 * Math.PI / 180;
            const ŒîœÜ = (lat2 - lat1) * Math.PI / 180;
            const ŒîŒª = (lon2 - lon1) * Math.PI / 180;

            const a = Math.sin(ŒîœÜ / 2) * Math.sin(ŒîœÜ / 2) +
                      Math.cos(œÜ1) * Math.cos(œÜ2) *
                      Math.sin(ŒîŒª / 2) * Math.sin(ŒîŒª / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

            return R * c; // Distance in meters
        }

        // Check Proximity
        function checkProximity() {
            if (!farmerLocation || !currentUser || currentUser.role !== 'farmer') return;

            const distance = calculateDistance(
                farmerLocation.lat,
                farmerLocation.lng,
                SHOP_LOCATION.lat,
                SHOP_LOCATION.lng
            );

            if (distance <= PROXIMITY_THRESHOLD) {
                notifyAdminProximity(distance);
            }
        }

        // Notify Admin of Proximity
        function notifyAdminProximity(distance) {
            const notification = {
                farmerId: currentUser.username,
                farmerName: currentUser.name,
                distance: Math.round(distance),
                timestamp: new Date().toISOString()
            };

            // Save to localStorage for admin
            const notifications = JSON.parse(localStorage.getItem('proximityNotifications') || '[]');
            
            // Check if already notified recently (within 5 minutes)
            const recentNotification = notifications.find(n => 
                n.farmerId === currentUser.username && 
                (new Date() - new Date(n.timestamp)) < 300000
            );

            if (!recentNotification) {
                notifications.push(notification);
                localStorage.setItem('proximityNotifications', JSON.stringify(notifications));
                
                // Show alert to farmer
                showProximityAlert(`‡§Ü‡§™ ${SHOP_LOCATION.name} ‡§∏‡•á ${Math.round(distance)} ‡§Æ‡•Ä‡§ü‡§∞ ‡§¶‡•Ç‡§∞ ‡§π‡•à‡§Ç`);
            }
        }

        // Show Proximity Alert
        function showProximityAlert(message) {
            const alert = document.getElementById('proximityAlert');
            alert.textContent = message;
            alert.classList.add('show');

            setTimeout(() => {
                alert.classList.remove('show');
            }, 5000);
        }

        // Update Admin Stats
        function updateAdminStats() {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            document.getElementById('totalFarmers').textContent = users.length;

            const notifications = JSON.parse(localStorage.getItem('proximityNotifications') || '[]');
            const recentNotifications = notifications.filter(n => 
                (new Date() - new Date(n.timestamp)) < 3600000 // Last hour
            );
            document.getElementById('nearbyFarmers').textContent = recentNotifications.length;

            if (recentNotifications.length > 0) {
                document.getElementById('notificationBadge').textContent = recentNotifications.length;
                document.getElementById('notificationBadge').style.display = 'block';
            }
        }

        // Load Admin Chats
        function loadAdminChats() {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const chatList = document.getElementById('adminChatList');

            if (users.length === 0) {
                chatList.innerHTML = '<div class="empty-state"><div class="empty-icon">üí¨</div><div>‡§ï‡•ã‡§à ‡§ï‡§ø‡§∏‡§æ‡§® ‡§™‡§Ç‡§ú‡•Ä‡§ï‡•É‡§§ ‡§®‡§π‡•Ä‡§Ç</div></div>';
                return;
            }

            chatList.innerHTML = users.map(user => `
                <div class="chat-item" onclick="openAdminChat('${user.username}')">
                    <div class="chat-avatar">${user.name.charAt(0).toUpperCase()}</div>
                    <div class="chat-info">
                        <div class="chat-name">${user.name}</div>
                        <div class="chat-message">${user.village}</div>
                    </div>
                    <div class="chat-meta">
                        <div class="chat-time">${user.phone}</div>
                    </div>
                </div>
            `).join('');
        }

        // Open Chat
        function openFarmerChat() {
            showScreen('chatScreen');
            document.getElementById('chatName').textContent = '‡§®‡§ø‡§≤‡•á‡§∂ ‡§∏‡•Ä‡§°‡•ç‡§∏';
            document.getElementById('chatAvatar').textContent = 'N';
            loadMessages('admin');
        }

        function openAdminChat(farmerId) {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const farmer = users.find(u => u.username === farmerId);
            
            if (farmer) {
                showScreen('chatScreen');
                document.getElementById('chatName').textContent = farmer.name;
                document.getElementById('chatAvatar').textContent = farmer.name.charAt(0).toUpperCase();
                loadMessages(farmerId);
            }
        }

        // Load Messages
        function loadMessages(chatWith) {
            const messages = JSON.parse(localStorage.getItem(`chat_${currentUser.username}_${chatWith}`) || '[]');
            const container = document.getElementById('chatMessages');

            if (messages.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-icon">üí¨</div><div>‡§ï‡•ã‡§à ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§®‡§π‡•Ä‡§Ç</div></div>';
                return;
            }

            container.innerHTML = messages.map(msg => `
                <div class="message-bubble ${msg.sender === currentUser.username ? 'message-sent' : 'message-received'}">
                    ${msg.text}
                    <div class="message-time">${new Date(msg.timestamp).toLocaleTimeString('hi-IN', {hour: '2-digit', minute: '2-digit'})}</div>
                </div>
            `).join('');

            container.scrollTop = container.scrollHeight;
        }

        // Send Message
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();

            if (!text) return;

            const chatWith = currentUser.role === 'farmer' ? 'admin' : 
                            document.getElementById('chatName').textContent;

            const message = {
                sender: currentUser.username,
                text: text,
                timestamp: new Date().toISOString()
            };

            const chatKey = `chat_${currentUser.username}_${chatWith}`;
            const messages = JSON.parse(localStorage.getItem(chatKey) || '[]');
            messages.push(message);
            localStorage.setItem(chatKey, JSON.stringify(messages));

            input.value = '';
            loadMessages(chatWith);
        }

        // Close Chat
        function closeChat() {
            if (currentUser.role === 'admin') {
                showScreen('adminDashboard');
            } else {
                showScreen('farmerDashboard');
            }
        }

        // Action Functions
        function makeCall() {
            window.location.href = 'tel:+919876543210';
        }

        function makeVideoCall() {
            alert('‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã ‡§ï‡•â‡§≤ ‡§∏‡•Å‡§µ‡§ø‡§ß‡§æ ‡§ú‡§≤‡•ç‡§¶ ‡§Ü ‡§∞‡§π‡•Ä ‡§π‡•à');
        }

        function openLedger() {
            window.open('https://docs.google.com/spreadsheets/d/1example', '_blank');
        }

        function showNotifications() {
            const notifications = JSON.parse(localStorage.getItem('proximityNotifications') || '[]');
            if (notifications.length === 0) {
                alert('‡§ï‡•ã‡§à ‡§®‡§à ‡§∏‡•Ç‡§ö‡§®‡§æ ‡§®‡§π‡•Ä‡§Ç');
                return;
            }

            const message = notifications.map(n => 
                `${n.farmerName} ${n.distance}m ‡§¶‡•Ç‡§∞ ‡§π‡•à`
            ).join('\n');
            
            alert(message);
        }

        // Menu Functions
        function openMenu() {
            document.getElementById('menuOverlay').classList.add('show');
            document.getElementById('menuPanel').classList.add('show');
        }

        function closeMenu() {
            document.getElementById('menuOverlay').classList.remove('show');
            document.getElementById('menuPanel').classList.remove('show');
        }

        function changeLanguage() {
            alert('‡§≠‡§æ‡§∑‡§æ ‡§¨‡§¶‡§≤‡§®‡•á ‡§ï‡•Ä ‡§∏‡•Å‡§µ‡§ø‡§ß‡§æ ‡§ú‡§≤‡•ç‡§¶ ‡§Ü ‡§∞‡§π‡•Ä ‡§π‡•à');
            closeMenu();
        }

        // Logout
        function logout() {
            if (locationWatchId) {
                navigator.geolocation.clearWatch(locationWatchId);
            }
            if (proximityCheckInterval) {
                clearInterval(proximityCheckInterval);
            }

            localStorage.removeItem('currentUser');
            currentUser = null;
            farmerLocation = null;
            
            showScreen('loginScreen');
            document.getElementById('loginForm').reset();
            closeMenu();
        }

        // Load User Session
        function loadUserSession() {
            const savedUser = localStorage.getItem('currentUser');

            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                if (currentUser.role === 'admin') {
                    showAdminDashboard();
                } else {
                    showFarmerDashboard();
                }
            }
        }

        // Show Error
        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.classList.add('show');
            setTimeout(() => {
                element.classList.remove('show');
            }, 3000);
        }

        // Show Success
        function showSuccess(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.classList.add('show');
            setTimeout(() => {
                element.classList.remove('show');
            }, 3000);
        }

        function showAdminChats() {
            // Already on admin dashboard, just scroll to chats
            document.querySelector('.chat-list').scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>