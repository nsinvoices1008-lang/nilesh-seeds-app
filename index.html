<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡§®‡§ø‡§≤‡•á‡§∂ ‡§∏‡•Ä‡§°‡•ç‡§∏ - Agriculture Retail App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 10px;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        /* Header */
        .app-header {
            position: sticky;
            top: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-title {
            font-size: 20px;
            color: #25D366;
            font-weight: 700;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .profile-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #25D366;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .profile-icon:hover {
            transform: scale(1.1);
        }

        .hamburger-btn {
            width: 40px;
            height: 40px;
            background: #25D366;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .hamburger-btn span {
            width: 22px;
            height: 3px;
            background: white;
            border-radius: 2px;
            transition: all 0.3s;
        }

        .hamburger-btn.active span:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }

        .hamburger-btn.active span:nth-child(2) {
            opacity: 0;
        }

        .hamburger-btn.active span:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -6px);
        }

        /* Dropdown Menu */
        .dropdown-menu {
            position: fixed;
            top: 70px;
            right: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            padding: 10px;
            min-width: 220px;
            display: none;
            z-index: 999;
            animation: slideDown 0.3s ease;
        }

        .dropdown-menu.active {
            display: block;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .menu-section {
            padding: 10px 0;
        }

        .menu-section-title {
            font-size: 12px;
            color: #667781;
            padding: 5px 10px;
            font-weight: 600;
        }

        .menu-item {
            padding: 12px 15px;
            cursor: pointer;
            border-radius: 8px;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #000;
            font-size: 15px;
        }

        .menu-item:hover {
            background: #f0f0f0;
        }

        .menu-item.danger {
            color: #dc3545;
        }

        .menu-divider {
            height: 1px;
            background: #e0e0e0;
            margin: 8px 0;
        }

        .language-btn {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .language-btn.active {
            background: #25D366;
            color: white;
            border-color: #25D366;
        }

        /* Profile Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 25px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 22px;
            font-weight: 700;
            color: #000;
        }

        .close-btn {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: #f0f0f0;
            border: none;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .close-btn:hover {
            background: #e0e0e0;
        }

        /* Auth Card */
        .auth-card {
            background: white;
            border-radius: 20px;
            padding: 30px 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            max-width: 450px;
            margin: 30px auto;
            width: calc(100% - 40px);
        }

        .logo {
            text-align: center;
            margin-bottom: 25px;
        }

        .logo-icon {
            font-size: 50px;
            margin-bottom: 10px;
        }

        .logo h1 {
            color: #25D366;
            font-size: 28px;
            margin-bottom: 5px;
        }

        .tagline {
            color: #667781;
            font-size: 13px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            color: #000;
            font-weight: 600;
            font-size: 14px;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #E9EDEF;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: #25D366;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .error, .success {
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
            display: none;
            font-size: 14px;
        }

        .error {
            background: #ffebee;
            color: #c62828;
        }

        .success {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .error.show, .success.show {
            display: block;
        }

        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }

        .btn-primary {
            background: #25D366;
            color: white;
        }

        .btn-primary:hover {
            background: #1ea952;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #000;
            margin-top: 10px;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .link-btn {
            background: none;
            border: none;
            color: #25D366;
            cursor: pointer;
            text-decoration: underline;
            font-size: 14px;
            margin-top: 15px;
            display: block;
            text-align: center;
        }

        /* Dashboard */
        .dashboard-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 700;
            color: #000;
        }

        .badge {
            background: #25D366;
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge.danger {
            background: #dc3545;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            color: #667781;
            font-size: 14px;
        }

        .info-value {
            color: #000;
            font-weight: 600;
            font-size: 14px;
        }

        /* Chat List */
        .chat-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .chat-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
        }

        .chat-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #25D366;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 700;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .chat-info {
            flex: 1;
            min-width: 0;
        }

        .chat-name {
            font-weight: 600;
            font-size: 16px;
            color: #000;
            margin-bottom: 4px;
        }

        .chat-preview {
            color: #667781;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-meta {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
        }

        .chat-time {
            color: #667781;
            font-size: 12px;
        }

        .unread-badge {
            background: #25D366;
            color: white;
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 12px;
            font-weight: 600;
            min-width: 20px;
            text-align: center;
        }

        /* Chat Window */
        .chat-window {
            background: white;
            border-radius: 16px;
            height: calc(100vh - 180px);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            padding: 15px 20px;
            background: #25D366;
            color: white;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-header-info {
            flex: 1;
        }

        .chat-header-name {
            font-weight: 600;
            font-size: 16px;
        }

        .chat-header-status {
            font-size: 12px;
            opacity: 0.9;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f0f2f5;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
        }

        .message.sent {
            flex-direction: row-reverse;
        }

        .message-bubble {
            max-width: 70%;
            padding: 10px 15px;
            border-radius: 12px;
            word-wrap: break-word;
        }

        .message.received .message-bubble {
            background: white;
            color: #000;
        }

        .message.sent .message-bubble {
            background: #25D366;
            color: white;
        }

        .message-time {
            font-size: 11px;
            opacity: 0.7;
            margin-top: 5px;
        }

        .chat-input-area {
            padding: 15px;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 24px;
            font-size: 15px;
            font-family: inherit;
        }

        .chat-input:focus {
            outline: none;
            border-color: #25D366;
        }

        .send-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: #25D366;
            color: white;
            border: none;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .send-btn:hover {
            background: #1ea952;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            z-index: 99;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            padding: 8px;
            transition: all 0.2s;
            position: relative;
        }

        .nav-item.active {
            color: #25D366;
        }

        .nav-icon {
            font-size: 24px;
        }

        .nav-label {
            font-size: 11px;
            font-weight: 600;
        }

        .nav-badge {
            position: absolute;
            top: 5px;
            right: 25%;
            background: #dc3545;
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 10px;
            font-weight: 600;
            min-width: 18px;
            text-align: center;
        }

        /* Proximity Alert */
        .proximity-alert {
            position: fixed;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            background: #ff9800;
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            display: none;
            animation: slideDown 0.3s ease;
            max-width: 90%;
            text-align: center;
        }

        .proximity-alert.show {
            display: block;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .auth-card {
                padding: 25px 15px;
            }

            .logo h1 {
                font-size: 24px;
            }

            .header-title {
                font-size: 18px;
            }

            .chat-window {
                height: calc(100vh - 140px);
            }

            .message-bubble {
                max-width: 85%;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 5px;
            }

            .dashboard-card {
                padding: 15px;
            }

            .card-title {
                font-size: 16px;
            }

            .chat-item {
                padding: 12px;
            }

            .chat-avatar {
                width: 45px;
                height: 45px;
                font-size: 18px;
            }
        }

        /* Loading Spinner */
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #25D366;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #667781;
        }

        .empty-state-icon {
            font-size: 60px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 16px;
        }
    </style>
</head>
<body>
    <!-- Proximity Alert -->
    <div id="proximityAlert" class="proximity-alert"></div>

    <!-- Login Screen -->
    <div id="loginScreen" class="screen active">
        <div class="container">
            <div class="auth-card">
                <div class="logo">
                    <div class="logo-icon">üåæ</div>
                    <h1 id="appTitle">‡§®‡§ø‡§≤‡•á‡§∂ ‡§∏‡•Ä‡§°‡•ç‡§∏</h1>
                    <p class="tagline" id="appTagline">‡§Ü‡§™‡§ï‡§æ ‡§µ‡§ø‡§∂‡•ç‡§µ‡§∏‡§®‡•Ä‡§Ø ‡§ï‡•É‡§∑‡§ø ‡§∏‡§æ‡§•‡•Ä</p>
                </div>
                <div id="loginError" class="error"></div>
                <div class="form-group">
                    <label id="usernameLabel">‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§®‡§æ‡§Æ</label>
                    <input type="text" id="loginUsername" placeholder="‡§Ö‡§™‡§®‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç">
                </div>
                <div class="form-group">
                    <label id="passwordLabel">‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°</label>
                    <input type="password" id="loginPassword" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç">
                </div>
                <button class="btn btn-primary" id="loginBtn">‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç</button>
                <button class="link-btn" id="showRegisterBtn">‡§®‡§Ø‡§æ ‡§ñ‡§æ‡§§‡§æ ‡§¨‡§®‡§æ‡§è‡§Ç</button>
            </div>
        </div>
    </div>

    <!-- Register Screen -->
    <div id="registerScreen" class="screen">
        <div class="container">
            <div class="auth-card">
                <div class="logo">
                    <div class="logo-icon">üåæ</div>
                    <h1 id="registerTitle">‡§®‡§Ø‡§æ ‡§ñ‡§æ‡§§‡§æ ‡§¨‡§®‡§æ‡§è‡§Ç</h1>
                </div>
                <div id="registerError" class="error"></div>
                <div id="registerSuccess" class="success"></div>
                <div class="form-group">
                    <label id="regNameLabel">‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ</label>
                    <input type="text" id="regName" placeholder="‡§Ö‡§™‡§®‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç">
                </div>
                <div class="form-group">
                    <label id="regPhoneLabel">‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞</label>
                    <input type="tel" id="regPhone" placeholder="10 ‡§Ö‡§Ç‡§ï‡•ã‡§Ç ‡§ï‡§æ ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞">
                </div>
                <div class="form-group">
                    <label id="regVillageLabel">‡§ó‡§æ‡§Ç‡§µ</label>
                    <input type="text" id="regVillage" placeholder="‡§Ö‡§™‡§®‡§æ ‡§ó‡§æ‡§Ç‡§µ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç">
                </div>
                <div class="form-group">
                    <label id="regAddressLabel">‡§™‡•Ç‡§∞‡§æ ‡§™‡§§‡§æ</label>
                    <textarea id="regAddress" placeholder="‡§Ö‡§™‡§®‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§™‡§§‡§æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç"></textarea>
                </div>
                <div class="form-group">
                    <label id="regPasswordLabel">‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°</label>
                    <input type="password" id="regPassword" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¨‡§®‡§æ‡§è‡§Ç">
                </div>
                <button class="btn btn-primary" id="registerBtn">‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç</button>
                <button class="link-btn" id="showLoginBtn">‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§ñ‡§æ‡§§‡§æ ‡§π‡•à? ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç</button>
            </div>
        </div>
    </div>

    <!-- Farmer Dashboard -->
    <div id="farmerDashboard" class="screen">
        <!-- Header -->
        <div class="app-header">
            <div class="header-left">
                <span class="header-title">‡§®‡§ø‡§≤‡•á‡§∂ ‡§∏‡•Ä‡§°‡•ç‡§∏</span>
            </div>
            <div class="header-right">
                <div class="profile-icon" id="farmerProfileIcon">üë§</div>
                <div class="hamburger-btn" id="farmerHamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>

        <!-- Dropdown Menu -->
        <div class="dropdown-menu" id="farmerDropdown">
            <div class="menu-section">
                <div class="menu-section-title">‡§≠‡§æ‡§∑‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç</div>
                <button class="language-btn active" data-lang="hi">üáÆüá≥ ‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
                <button class="language-btn" data-lang="en">üá¨üáß English</button>
                <button class="language-btn" data-lang="mr">üáÆüá≥ ‡§Æ‡§∞‡§æ‡§†‡•Ä</button>
            </div>
            <div class="menu-divider"></div>
            <div class="menu-item danger" id="farmerLogoutBtn">
                <span>üö™</span>
                <span>‡§≤‡•â‡§ó‡§Ü‡§â‡§ü</span>
            </div>
        </div>

        <div class="container" style="padding-bottom: 80px;">
            <!-- Profile Card -->
            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-title">‡§Æ‡•á‡§∞‡•Ä ‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤</div>
                    <div class="badge" id="locationStatus">üìç ‡§∏‡•ç‡§•‡§æ‡§® ‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø</div>
                </div>
                <div class="info-row">
                    <span class="info-label">‡§®‡§æ‡§Æ</span>
                    <span class="info-value" id="farmerNameDisplay">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤</span>
                    <span class="info-value" id="farmerPhoneDisplay">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">‡§ó‡§æ‡§Ç‡§µ</span>
                    <span class="info-value" id="farmerVillageDisplay">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§∏‡•ç‡§•‡§æ‡§®</span>
                    <span class="info-value" id="farmerLocationDisplay">‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...</span>
                </div>
                <button class="btn btn-secondary" id="editFarmerProfileBtn" style="margin-top: 15px;">‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤ ‡§∏‡§Ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç</button>
            </div>

            <!-- Weather Card -->
            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-title">‡§Æ‡•å‡§∏‡§Æ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä</div>
                </div>
                <div id="weatherInfo">
                    <div class="spinner"></div>
                </div>
            </div>

            <!-- Ledger Card -->
            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-title">‡§Æ‡•á‡§∞‡§æ ‡§ñ‡§æ‡§§‡§æ</div>
                </div>
                <div class="info-row">
                    <span class="info-label">‡§ñ‡§æ‡§§‡§æ ‡§¨‡§π‡•Ä ‡§≤‡§ø‡§Ç‡§ï</span>
                    <span class="info-value" id="farmerLedgerLink">-</span>
                </div>
                <button class="btn btn-primary" id="openLedgerBtn">‡§ñ‡§æ‡§§‡§æ ‡§¨‡§π‡•Ä ‡§ñ‡•ã‡§≤‡•á‡§Ç</button>
            </div>

            <!-- Admin Chat -->
            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-title">‡§®‡§ø‡§≤‡•á‡§∂ ‡§∏‡•Ä‡§°‡•ç‡§∏ ‡§∏‡•á ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§Ç</div>
                    <div class="unread-badge" id="adminChatBadge" style="display: none;">0</div>
                </div>
                <button class="btn btn-primary" id="openAdminChatBtn">‡§ö‡•à‡§ü ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç</button>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="nav-item active" data-tab="home">
                <div class="nav-icon">üè†</div>
                <div class="nav-label">‡§π‡•ã‡§Æ</div>
            </div>
            <div class="nav-item" data-tab="chat">
                <div class="nav-icon">üí¨</div>
                <div class="nav-label">‡§ö‡•à‡§ü</div>
                <div class="nav-badge" id="farmerChatBadge" style="display: none;">0</div>
            </div>
            <div class="nav-item" data-tab="profile">
                <div class="nav-icon">üë§</div>
                <div class="nav-label">‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤</div>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="screen">
        <!-- Header -->
        <div class="app-header">
            <div class="header-left">
                <span class="header-title">‡§®‡§ø‡§≤‡•á‡§∂ ‡§∏‡•Ä‡§°‡•ç‡§∏ - Admin</span>
            </div>
            <div class="header-right">
                <div class="profile-icon" id="adminProfileIcon">üë§</div>
                <div class="hamburger-btn" id="adminHamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>

        <!-- Dropdown Menu -->
        <div class="dropdown-menu" id="adminDropdown">
            <div class="menu-section">
                <div class="menu-section-title">‡§≠‡§æ‡§∑‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç</div>
                <button class="language-btn active" data-lang="hi">üáÆüá≥ ‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
                <button class="language-btn" data-lang="en">üá¨üáß English</button>
                <button class="language-btn" data-lang="mr">üáÆüá≥ ‡§Æ‡§∞‡§æ‡§†‡•Ä</button>
            </div>
            <div class="menu-divider"></div>
            <div class="menu-item danger" id="adminLogoutBtn">
                <span>üö™</span>
                <span>‡§≤‡•â‡§ó‡§Ü‡§â‡§ü</span>
            </div>
        </div>

        <div class="container" style="padding-bottom: 80px;">
            <!-- Stats Card -->
            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-title">‡§Ü‡§ú ‡§ï‡§æ ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂</div>
                </div>
                <div class="info-row">
                    <span class="info-label">‡§ï‡•Å‡§≤ ‡§ï‡§ø‡§∏‡§æ‡§®</span>
                    <span class="info-value" id="totalFarmers">0</span>
                </div>
                <div class="info-row">
                    <span class="info-label">‡§®‡§è ‡§∏‡§Ç‡§¶‡•á‡§∂</span>
                    <span class="info-value" id="totalUnreadMessages">0</span>
                </div>
                <div class="info-row">
                    <span class="info-label">‡§Ü‡§∏-‡§™‡§æ‡§∏ ‡§ï‡•á ‡§ï‡§ø‡§∏‡§æ‡§®</span>
                    <span class="info-value" id="nearbyFarmers">0</span>
                </div>
            </div>

            <!-- Farmers List -->
            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-title">‡§ï‡§ø‡§∏‡§æ‡§® ‡§∏‡•Ç‡§ö‡•Ä</div>
                </div>
                <div id="farmersList">
                    <div class="empty-state">
                        <div class="empty-state-icon">üë•</div>
                        <div class="empty-state-text">‡§ï‡•ã‡§à ‡§ï‡§ø‡§∏‡§æ‡§® ‡§™‡§Ç‡§ú‡•Ä‡§ï‡•É‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="nav-item active" data-tab="home">
                <div class="nav-icon">üè†</div>
                <div class="nav-label">‡§π‡•ã‡§Æ</div>
            </div>
            <div class="nav-item" data-tab="chats">
                <div class="nav-icon">üí¨</div>
                <div class="nav-label">‡§ö‡•à‡§ü</div>
                <div class="nav-badge" id="adminChatBadge" style="display: none;">0</div>
            </div>
            <div class="nav-item" data-tab="farmers">
                <div class="nav-icon">üë•</div>
                <div class="nav-label">‡§ï‡§ø‡§∏‡§æ‡§®</div>
            </div>
        </div>
    </div>

    <!-- Chat Screen -->
    <div id="chatScreen" class="screen">
        <div class="container" style="padding: 0;">
            <div class="chat-window">
                <div class="chat-header">
                    <button class="back-btn" id="backToDashboard">‚Üê</button>
                    <div class="chat-header-info">
                        <div class="chat-header-name" id="chatHeaderName">-</div>
                        <div class="chat-header-status" id="chatHeaderStatus">‡§ë‡§®‡§≤‡§æ‡§á‡§®</div>
                    </div>
                    <button class="btn btn-primary" id="videoCallBtn" style="width: auto; padding: 8px 15px; font-size: 14px;">üìπ ‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã ‡§ï‡•â‡§≤</button>
                </div>
                <div class="chat-messages" id="chatMessages">
                    <div class="empty-state">
                        <div class="empty-state-icon">üí¨</div>
                        <div class="empty-state-text">‡§ï‡•ã‡§à ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à</div>
                    </div>
                </div>
                <div class="chat-input-area">
                    <input type="text" class="chat-input" id="messageInput" placeholder="‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§≤‡§ø‡§ñ‡•á‡§Ç...">
                    <button class="send-btn" id="sendMessageBtn">‚û§</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Edit Modal -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤ ‡§∏‡§Ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç</div>
                <button class="close-btn" id="closeProfileModal">√ó</button>
            </div>
            <div id="profileEditError" class="error"></div>
            <div id="profileEditSuccess" class="success"></div>
            <div class="form-group">
                <label>‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ</label>
                <input type="text" id="editName">
            </div>
            <div class="form-group">
                <label>‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞</label>
                <input type="tel" id="editPhone">
            </div>
            <div class="form-group">
                <label>‡§ó‡§æ‡§Ç‡§µ</label>
                <input type="text" id="editVillage">
            </div>
            <div class="form-group">
                <label>‡§™‡•Ç‡§∞‡§æ ‡§™‡§§‡§æ</label>
                <textarea id="editAddress"></textarea>
            </div>
            <div class="form-group">
                <label>‡§ñ‡§æ‡§§‡§æ ‡§¨‡§π‡•Ä ‡§≤‡§ø‡§Ç‡§ï</label>
                <input type="url" id="editLedgerLink" placeholder="https://example.com/ledger">
            </div>
            <button class="btn btn-primary" id="saveProfileBtn">‡§∏‡§π‡•á‡§ú‡•á‡§Ç</button>
        </div>
    </div>

    <!-- Video Call Modal -->
    <div id="videoCallModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <div class="modal-title">‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã ‡§ï‡•â‡§≤</div>
                <button class="close-btn" id="closeVideoCall">√ó</button>
            </div>
            <div style="text-align: center; padding: 40px;">
                <div style="font-size: 60px; margin-bottom: 20px;">üìπ</div>
                <div style="font-size: 18px; margin-bottom: 30px;">‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã ‡§ï‡•â‡§≤ ‡§ï‡§®‡•á‡§ï‡•ç‡§ü ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</div>
                <button class="btn btn-danger" id="endVideoCall">‡§ï‡•â‡§≤ ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç</button>
            </div>
        </div>
    </div>

    <script>
        // Translations
        const translations = {
            hi: {
                appTitle: '‡§®‡§ø‡§≤‡•á‡§∂ ‡§∏‡•Ä‡§°‡•ç‡§∏',
                appTagline: '‡§Ü‡§™‡§ï‡§æ ‡§µ‡§ø‡§∂‡•ç‡§µ‡§∏‡§®‡•Ä‡§Ø ‡§ï‡•É‡§∑‡§ø ‡§∏‡§æ‡§•‡•Ä',
                usernameLabel: '‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§®‡§æ‡§Æ',
                passwordLabel: '‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°',
                loginBtn: '‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç',
                showRegisterBtn: '‡§®‡§Ø‡§æ ‡§ñ‡§æ‡§§‡§æ ‡§¨‡§®‡§æ‡§è‡§Ç',
                registerTitle: '‡§®‡§Ø‡§æ ‡§ñ‡§æ‡§§‡§æ ‡§¨‡§®‡§æ‡§è‡§Ç',
                regNameLabel: '‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ',
                regPhoneLabel: '‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞',
                regVillageLabel: '‡§ó‡§æ‡§Ç‡§µ',
                regAddressLabel: '‡§™‡•Ç‡§∞‡§æ ‡§™‡§§‡§æ',
                regPasswordLabel: '‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°',
                registerBtn: '‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç',
                showLoginBtn: '‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§ñ‡§æ‡§§‡§æ ‡§π‡•à? ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç',
                logout: '‡§≤‡•â‡§ó‡§Ü‡§â‡§ü'
            },
            en: {
                appTitle: 'Nilesh Seeds',
                appTagline: 'Your Trusted Agriculture Partner',
                usernameLabel: 'Username',
                passwordLabel: 'Password',
                loginBtn: 'Login',
                showRegisterBtn: 'Create New Account',
                registerTitle: 'Create New Account',
                regNameLabel: 'Full Name',
                regPhoneLabel: 'Mobile Number',
                regVillageLabel: 'Village',
                regAddressLabel: 'Full Address',
                regPasswordLabel: 'Password',
                registerBtn: 'Register',
                showLoginBtn: 'Already have an account? Login',
                logout: 'Logout'
            },
            mr: {
                appTitle: '‡§®‡§ø‡§≤‡•á‡§∂ ‡§∏‡•Ä‡§°‡•ç‡§∏',
                appTagline: '‡§§‡•Å‡§Æ‡§ö‡§æ ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏‡•Ç ‡§∂‡•á‡§§‡•Ä ‡§∏‡§æ‡§•‡•Ä',
                usernameLabel: '‡§µ‡§æ‡§™‡§∞‡§ï‡§∞‡•ç‡§§‡§æ ‡§®‡§æ‡§µ',
                passwordLabel: '‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°',
                loginBtn: '‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡§æ',
                showRegisterBtn: '‡§®‡§µ‡•Ä‡§® ‡§ñ‡§æ‡§§‡•á ‡§§‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡§æ',
                registerTitle: '‡§®‡§µ‡•Ä‡§® ‡§ñ‡§æ‡§§‡•á ‡§§‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡§æ',
                regNameLabel: '‡§™‡•Ç‡§∞‡•ç‡§£ ‡§®‡§æ‡§µ',
                regPhoneLabel: '‡§Æ‡•ã‡§¨‡§æ‡§à‡§≤ ‡§®‡§Ç‡§¨‡§∞',
                regVillageLabel: '‡§ó‡§æ‡§µ',
                regAddressLabel: '‡§™‡•Ç‡§∞‡•ç‡§£ ‡§™‡§§‡•ç‡§§‡§æ',
                regPasswordLabel: '‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°',
                registerBtn: '‡§®‡•ã‡§Ç‡§¶‡§£‡•Ä ‡§ï‡§∞‡§æ',
                showLoginBtn: '‡§Ü‡§ß‡•Ä‡§ö ‡§ñ‡§æ‡§§‡•á ‡§Ü‡§π‡•á? ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡§æ',
                logout: '‡§≤‡•â‡§ó‡§Ü‡§â‡§ü'
            }
        };

        // App State
        let currentUser = null;
        let currentLanguage = 'hi';
        let currentChat = null;
        let watchId = null;
        let notificationPermission = false;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            requestNotificationPermission();
            loadUserSession();
            setupEventListeners();
            startLocationTracking();
        });

        // Request Notification Permission
        function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission().then(permission => {
                    notificationPermission = permission === 'granted';
                });
            } else if (Notification.permission === 'granted') {
                notificationPermission = true;
            }
        }

        // Show Notification
        function showNotification(title, body) {
            if (notificationPermission) {
                new Notification(title, {
                    body: body,
                    icon: 'üåæ',
                    badge: 'üåæ'
                });
            }
        }

        // Setup Event Listeners
        function setupEventListeners() {
            // Login/Register
            document.getElementById('loginBtn').addEventListener('click', handleLogin);
            document.getElementById('registerBtn').addEventListener('click', handleRegister);
            document.getElementById('showRegisterBtn').addEventListener('click', () => showScreen('registerScreen'));
            document.getElementById('showLoginBtn').addEventListener('click', () => showScreen('loginScreen'));

            // Hamburger Menus
            document.getElementById('farmerHamburger').addEventListener('click', toggleDropdown);
            document.getElementById('adminHamburger').addEventListener('click', toggleDropdown);

            // Profile Icons
            document.getElementById('farmerProfileIcon').addEventListener('click', () => {
                document.getElementById('profileModal').classList.add('active');
                loadProfileData();
            });
            document.getElementById('adminProfileIcon').addEventListener('click', () => {
                alert('Admin Profile');
            });

            // Language Buttons
            document.querySelectorAll('.language-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const lang = e.target.dataset.lang;
                    changeLanguage(lang);
                });
            });

            // Logout Buttons
            document.getElementById('farmerLogoutBtn').addEventListener('click', logout);
            document.getElementById('adminLogoutBtn').addEventListener('click', logout);

            // Profile Edit
            document.getElementById('editFarmerProfileBtn').addEventListener('click', () => {
                document.getElementById('profileModal').classList.add('active');
                loadProfileData();
            });
            document.getElementById('closeProfileModal').addEventListener('click', () => {
                document.getElementById('profileModal').classList.remove('active');
            });
            document.getElementById('saveProfileBtn').addEventListener('click', saveProfile);

            // Chat
            document.getElementById('openAdminChatBtn').addEventListener('click', () => openChat('admin'));
            document.getElementById('backToDashboard').addEventListener('click', () => {
                if (currentUser.role === 'admin') {
                    showScreen('adminDashboard');
                } else {
                    showScreen('farmerDashboard');
                }
            });
            document.getElementById('sendMessageBtn').addEventListener('click', sendMessage);
            document.getElementById('messageInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });

            // Video Call
            document.getElementById('videoCallBtn').addEventListener('click', () => {
                document.getElementById('videoCallModal').classList.add('active');
            });
            document.getElementById('closeVideoCall').addEventListener('click', () => {
                document.getElementById('videoCallModal').classList.remove('active');
            });
            document.getElementById('endVideoCall').addEventListener('click', () => {
                document.getElementById('videoCallModal').classList.remove('active');
            });

            // Ledger
            document.getElementById('openLedgerBtn').addEventListener('click', () => {
                const ledgerLink = localStorage.getItem(`ledger_${currentUser.username}`);
                if (ledgerLink) {
                    window.open(ledgerLink, '_blank');
                } else {
                    alert('‡§ñ‡§æ‡§§‡§æ ‡§¨‡§π‡•Ä ‡§≤‡§ø‡§Ç‡§ï ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à');
                }
            });

            // Close dropdowns when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.hamburger-btn') && !e.target.closest('.dropdown-menu')) {
                    document.querySelectorAll('.dropdown-menu').forEach(menu => {
                        menu.classList.remove('active');
                    });
                    document.querySelectorAll('.hamburger-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                }
            });
        }

        // Toggle Dropdown
        function toggleDropdown(e) {
            e.stopPropagation();
            const btn = e.currentTarget;
            const dropdown = btn.parentElement.parentElement.querySelector('.dropdown-menu');
            
            // Close all other dropdowns
            document.querySelectorAll('.dropdown-menu').forEach(menu => {
                if (menu !== dropdown) {
                    menu.classList.remove('active');
                }
            });
            document.querySelectorAll('.hamburger-btn').forEach(b => {
                if (b !== btn) {
                    b.classList.remove('active');
                }
            });

            // Toggle current dropdown
            btn.classList.toggle('active');
            dropdown.classList.toggle('active');
        }

        // Change Language
        function changeLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('language', lang);

            // Update active button
            document.querySelectorAll('.language-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });

            // Update UI text
            const t = translations[lang];
            Object.keys(t).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    if (element.tagName === 'INPUT' || element.tagName === 'BUTTON') {
                        if (element.placeholder !== undefined) {
                            element.placeholder = t[key];
                        } else {
                            element.textContent = t[key];
                        }
                    } else {
                        element.textContent = t[key];
                    }
                }
            });

            // Close dropdown
            document.querySelectorAll('.dropdown-menu').forEach(menu => {
                menu.classList.remove('active');
            });
            document.querySelectorAll('.hamburger-btn').forEach(btn => {
                btn.classList.remove('active');
            });
        }

        // Show Screen
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        // Handle Login
        function handleLogin() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!username || !password) {
                showError('loginError', '‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç');
                return;
            }

            // Admin login
            if (username === 'Nilesh Seeds' && password === '1008') {
                currentUser = {
                    username: 'Nilesh Seeds',
                    role: 'admin',
                    name: 'Nilesh Seeds'
                };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showScreen('adminDashboard');
                loadAdminDashboard();
                return;
            }

            // Farmer login
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const user = users.find(u => u.username === username && u.password === password);

            if (user) {
                currentUser = { ...user, role: 'farmer' };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showScreen('farmerDashboard');
                loadFarmerDashboard();
            } else {
                showError('loginError', '‡§ó‡§≤‡§§ ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§®‡§æ‡§Æ ‡§Ø‡§æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°');
            }
        }

        // Handle Register
        function handleRegister() {
            const name = document.getElementById('regName').value.trim();
            const phone = document.getElementById('regPhone').value.trim();
            const village = document.getElementById('regVillage').value.trim();
            const address = document.getElementById('regAddress').value.trim();
            const password = document.getElementById('regPassword').value;

            if (!name || !phone || !village || !address || !password) {
                showError('registerError', '‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç');
                return;
            }

            if (phone.length !== 10) {
                showError('registerError', '‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ 10 ‡§Ö‡§Ç‡§ï‡•ã‡§Ç ‡§ï‡§æ ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è');
                return;
            }

            const users = JSON.parse(localStorage.getItem('users') || '[]');
            
            if (users.find(u => u.phone === phone)) {
                showError('registerError', '‡§Ø‡§π ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§™‡§Ç‡§ú‡•Ä‡§ï‡•É‡§§ ‡§π‡•à');
                return;
            }

            const newUser = {
                username: phone,
                password: password,
                name: name,
                phone: phone,
                village: village,
                address: address,
                ledgerLink: '',
                createdAt: new Date().toISOString()
            };

            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));

            showSuccess('registerSuccess', '‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£ ‡§∏‡§´‡§≤! ‡§ï‡•É‡§™‡§Ø‡§æ ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç');
            setTimeout(() => {
                showScreen('loginScreen');
            }, 2000);
        }

        // Load User Session
        function loadUserSession() {
            const savedUser = localStorage.getItem('currentUser');
            const savedLang = localStorage.getItem('language');

            if (savedLang) {
                changeLanguage(savedLang);
            }

            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                if (currentUser.role === 'admin') {
                    showScreen('adminDashboard');
                    loadAdminDashboard();
                } else {
                    showScreen('farmerDashboard');
                    loadFarmerDashboard();
                }
            }
        }

        // Load Farmer Dashboard
        function loadFarmerDashboard() {
            document.getElementById('farmerNameDisplay').textContent = currentUser.name;
            document.getElementById('farmerPhoneDisplay').textContent = currentUser.phone;
            document.getElementById('farmerVillageDisplay').textContent = currentUser.village;

            const ledgerLink = localStorage.getItem(`ledger_${currentUser.username}`);
            if (ledgerLink) {
                document.getElementById('farmerLedgerLink').innerHTML = `<a href="${ledgerLink}" target="_blank" style="color: #25D366;">‡§≤‡§ø‡§Ç‡§ï ‡§ñ‡•ã‡§≤‡•á‡§Ç</a>`;
            }

            loadWeather();
            updateUnreadCount();
        }

        // Load Admin Dashboard
        function loadAdminDashboard() {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            document.getElementById('totalFarmers').textContent = users.length;
            
            loadFarmersList();
            updateAdminUnreadCount();
            checkProximityAlerts();
        }

        // Load Farmers List
        function loadFarmersList() {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const container = document.getElementById('farmersList');

            if (users.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üë•</div>
                        <div class="empty-state-text">‡§ï‡•ã‡§à ‡§ï‡§ø‡§∏‡§æ‡§® ‡§™‡§Ç‡§ú‡•Ä‡§ï‡•É‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = users.map(user => `
                <div class="chat-item" onclick="openChat('${user.username}')">
                    <div class="chat-avatar">${user.name.charAt(0)}</div>
                    <div class="chat-info">
                        <div class="chat-name">${user.name}</div>
                        <div class="chat-preview">${user.village} ‚Ä¢ ${user.phone}</div>
                    </div>
                    <div class="chat-meta">
                        <div class="unread-badge" id="unread_${user.username}" style="display: none;">0</div>
                    </div>
                </div>
            `).join('');
        }

        // Load Profile Data
        function loadProfileData() {
            document.getElementById('editName').value = currentUser.name;
            document.getElementById('editPhone').value = currentUser.phone;
            document.getElementById('editVillage').value = currentUser.village;
            document.getElementById('editAddress').value = currentUser.address;
            document.getElementById('editLedgerLink').value = localStorage.getItem(`ledger_${currentUser.username}`) || '';
        }

        // Save Profile
        function saveProfile() {
            const name = document.getElementById('editName').value.trim();
            const phone = document.getElementById('editPhone').value.trim();
            const village = document.getElementById('editVillage').value.trim();
            const address = document.getElementById('editAddress').value.trim();
            const ledgerLink = document.getElementById('editLedgerLink').value.trim();

            if (!name || !phone || !village || !address) {
                showError('profileEditError', '‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç');
                return;
            }

            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const userIndex = users.findIndex(u => u.username === currentUser.username);

            if (userIndex !== -1) {
                users[userIndex] = {
                    ...users[userIndex],
                    name,
                    phone,
                    village,
                    address
                };
                localStorage.setItem('users', JSON.stringify(users));
                
                if (ledgerLink) {
                    localStorage.setItem(`ledger_${currentUser.username}`, ledgerLink);
                }

                currentUser = { ...currentUser, name, phone, village, address };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));

                showSuccess('profileEditSuccess', '‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•Å‡§à');
                setTimeout(() => {
                    document.getElementById('profileModal').classList.remove('active');
                    loadFarmerDashboard();
                }, 1500);
            }
        }

        // Open Chat
        function openChat(userId) {
            currentChat = userId;
            showScreen('chatScreen');

            if (userId === 'admin') {
                document.getElementById('chatHeaderName').textContent = '‡§®‡§ø‡§≤‡•á‡§∂ ‡§∏‡•Ä‡§°‡•ç‡§∏';
            } else {
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const user = users.find(u => u.username === userId);
                if (user) {
                    document.getElementById('chatHeaderName').textContent = user.name;
                }
            }

            loadMessages();
            markAsRead(userId);
        }

        // Load Messages
        function loadMessages() {
            const chatKey = currentUser.role === 'admin' 
                ? `chat_admin_${currentChat}` 
                : `chat_admin_${currentUser.username}`;
            
            const messages = JSON.parse(localStorage.getItem(chatKey) || '[]');
            const container = document.getElementById('chatMessages');

            if (messages.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üí¨</div>
                        <div class="empty-state-text">‡§ï‡•ã‡§à ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = messages.map(msg => `
                <div class="message ${msg.sender === currentUser.username ? 'sent' : 'received'}">
                    <div class="message-bubble">
                        ${msg.text}
                        <div class="message-time">${new Date(msg.timestamp).toLocaleTimeString('hi-IN', { hour: '2-digit', minute: '2-digit' })}</div>
                    </div>
                </div>
            `).join('');

            container.scrollTop = container.scrollHeight;
        }

        // Send Message
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();

            if (!text) return;

            const chatKey = currentUser.role === 'admin' 
                ? `chat_admin_${currentChat}` 
                : `chat_admin_${currentUser.username}`;
            
            const messages = JSON.parse(localStorage.getItem(chatKey) || '[]');
            
            const newMessage = {
                sender: currentUser.username,
                text: text,
                timestamp: new Date().toISOString(),
                read: false
            };

            messages.push(newMessage);
            localStorage.setItem(chatKey, JSON.stringify(messages));

            input.value = '';
            loadMessages();

            // Send notification to recipient
            const recipientName = currentUser.role === 'admin' ? currentChat : '‡§®‡§ø‡§≤‡•á‡§∂ ‡§∏‡•Ä‡§°‡•ç‡§∏';
            showNotification('‡§®‡§Ø‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂', `${currentUser.name}: ${text}`);
        }

        // Mark as Read
        function markAsRead(userId) {
            const chatKey = currentUser.role === 'admin' 
                ? `chat_admin_${userId}` 
                : `chat_admin_${currentUser.username}`;
            
            const messages = JSON.parse(localStorage.getItem(chatKey) || '[]');
            messages.forEach(msg => {
                if (msg.sender !== currentUser.username) {
                    msg.read = true;
                }
            });
            localStorage.setItem(chatKey, JSON.stringify(messages));

            updateUnreadCount();
            updateAdminUnreadCount();
        }

        // Update Unread Count
        function updateUnreadCount() {
            if (currentUser.role !== 'farmer') return;

            const chatKey = `chat_admin_${currentUser.username}`;
            const messages = JSON.parse(localStorage.getItem(chatKey) || '[]');
            const unreadCount = messages.filter(msg => msg.sender !== currentUser.username && !msg.read).length;

            const badge = document.getElementById('adminChatBadge');
            const navBadge = document.getElementById('farmerChatBadge');

            if (unreadCount > 0) {
                badge.textContent = unreadCount;
                badge.style.display = 'block';
                navBadge.textContent = unreadCount;
                navBadge.style.display = 'block';
            } else {
                badge.style.display = 'none';
                navBadge.style.display = 'none';
            }
        }

        // Update Admin Unread Count
        function updateAdminUnreadCount() {
            if (currentUser.role !== 'admin') return;

            const users = JSON.parse(localStorage.getItem('users') || '[]');
            let totalUnread = 0;

            users.forEach(user => {
                const chatKey = `chat_admin_${user.username}`;
                const messages = JSON.parse(localStorage.getItem(chatKey) || '[]');
                const unreadCount = messages.filter(msg => msg.sender !== 'Nilesh Seeds' && !msg.read).length;
                
                totalUnread += unreadCount;

                const badge = document.getElementById(`unread_${user.username}`);
                if (badge) {
                    if (unreadCount > 0) {
                        badge.textContent = unreadCount;
                        badge.style.display = 'block';
                    } else {
                        badge.style.display = 'none';
                    }
                }
            });

            document.getElementById('totalUnreadMessages').textContent = totalUnread;

            const navBadge = document.getElementById('adminChatBadge');
            if (totalUnread > 0) {
                navBadge.textContent = totalUnread;
                navBadge.style.display = 'block';
            } else {
                navBadge.style.display = 'none';
            }
        }

        // Start Location Tracking
        function startLocationTracking() {
            if ('geolocation' in navigator) {
                watchId = navigator.geolocation.watchPosition(
                    position => {
                        const { latitude, longitude } = position.coords;
                        
                        if (currentUser) {
                            localStorage.setItem(`location_${currentUser.username}`, JSON.stringify({
                                latitude,
                                longitude,
                                timestamp: new Date().toISOString()
                            }));

                            if (currentUser.role === 'farmer') {
                                document.getElementById('farmerLocationDisplay').textContent = 
                                    `${latitude.toFixed(4)}, ${longitude.toFixed(4)}`;
                            }
                        }
                    },
                    error => {
                        console.error('Location error:', error);
                    },
                    {
                        enableHighAccuracy: true,
                        maximumAge: 10000,
                        timeout: 5000
                    }
                );
            }
        }

        // Check Proximity Alerts
        function checkProximityAlerts() {
            if (currentUser.role !== 'admin') return;

            const shopLocation = { lat: 20.5937, lng: 78.9629 }; // Example coordinates
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            let nearbyCount = 0;

            users.forEach(user => {
                const locationData = localStorage.getItem(`location_${user.username}`);
                if (locationData) {
                    const { latitude, longitude } = JSON.parse(locationData);
                    const distance = calculateDistance(shopLocation.lat, shopLocation.lng, latitude, longitude);

                    if (distance <= 100) {
                        nearbyCount++;
                        
                        const lastAlert = localStorage.getItem(`alert_${user.username}`);
                        const now = Date.now();
                        
                        if (!lastAlert || (now - parseInt(lastAlert)) > 300000) { // 5 minutes
                            showProximityAlert(user.name, Math.round(distance));
                            showNotification('‡§ï‡§ø‡§∏‡§æ‡§® ‡§Ü‡§∏-‡§™‡§æ‡§∏ ‡§π‡•à', `${user.name} ${Math.round(distance)}m ‡§¶‡•Ç‡§∞ ‡§π‡•à`);
                            localStorage.setItem(`alert_${user.username}`, now.toString());
                        }
                    }
                }
            });

            document.getElementById('nearbyFarmers').textContent = nearbyCount;
        }

        // Show Proximity Alert
        function showProximityAlert(name, distance) {
            const alert = document.getElementById('proximityAlert');
            alert.textContent = `${name} ${distance}m ‡§¶‡•Ç‡§∞ ‡§π‡•à ‡§®‡§ø‡§≤‡•á‡§∂ ‡§∏‡•Ä‡§°‡•ç‡§∏ ‡§∏‡•á`;
            alert.classList.add('show');

            setTimeout(() => {
                alert.classList.remove('show');
            }, 5000);
        }

        // Calculate Distance
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371e3; // Earth radius in meters
            const œÜ1 = lat1 * Math.PI / 180;
            const œÜ2 = lat2 * Math.PI / 180;
            const ŒîœÜ = (lat2 - lat1) * Math.PI / 180;
            const ŒîŒª = (lon2 - lon1) * Math.PI / 180;

            const a = Math.sin(ŒîœÜ / 2) * Math.sin(ŒîœÜ / 2) +
                    Math.cos(œÜ1) * Math.cos(œÜ2) *
                    Math.sin(ŒîŒª / 2) * Math.sin(ŒîŒª / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

            return R * c;
        }

        // Load Weather
        function loadWeather() {
            const locationData = localStorage.getItem(`location_${currentUser.username}`);
            
            if (locationData) {
                const { latitude, longitude } = JSON.parse(locationData);
                
                // Simulated weather data
                const weatherInfo = document.getElementById('weatherInfo');
                weatherInfo.innerHTML = `
                    <div class="info-row">
                        <span class="info-label">‡§§‡§æ‡§™‡§Æ‡§æ‡§®</span>
                        <span class="info-value">28¬∞C</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">‡§Æ‡•å‡§∏‡§Æ</span>
                        <span class="info-value">‡§∏‡§æ‡§´ ‡§Ü‡§∏‡§Æ‡§æ‡§® ‚òÄÔ∏è</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">‡§Ü‡§∞‡•ç‡§¶‡•ç‡§∞‡§§‡§æ</span>
                        <span class="info-value">65%</span>
                    </div>
                `;
            } else {
                document.getElementById('weatherInfo').innerHTML = `
                    <div class="info-row">
                        <span class="info-label">‡§∏‡•ç‡§•‡§æ‡§® ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...</span>
                    </div>
                `;
            }
        }

        // Logout
        function logout() {
            localStorage.removeItem('currentUser');
            currentUser = null;
            currentChat = null;
            
            if (watchId) {
                navigator.geolocation.clearWatch(watchId);
            }

            showScreen('loginScreen');
            
            // Close dropdown
            document.querySelectorAll('.dropdown-menu').forEach(menu => {
                menu.classList.remove('active');
            });
            document.querySelectorAll('.hamburger-btn').forEach(btn => {
                btn.classList.remove('active');
            });
        }

        // Show Error
        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.classList.add('show');
            setTimeout(() => {
                element.classList.remove('show');
            }, 3000);
        }

        // Show Success
        function showSuccess(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.classList.add('show');
            setTimeout(() => {
                element.classList.remove('show');
            }, 3000);
        }

        // Periodic Updates
        setInterval(() => {
            if (currentUser) {
                if (currentUser.role === 'admin') {
                    checkProximityAlerts();
                    updateAdminUnreadCount();
                } else {
                    updateUnreadCount();
                }
            }
        }, 10000); // Every 10 seconds
    </script>
</body>
</html>